<!doctype html>
<html lang="fr">

<head>
  <meta charset="UTF-8">
  <title>Menu</title>
  <link rel="icon" type="image/png" sizes="64x64" href="./favicon.png">

  <style>
    body {
      background: #333;
      color: white;
      font-family: Arial;
      text-align: center;
      overflow: hidden;
      margin: 0;
      padding: 0;
    }

    .titlemenu {
      font-size: 48px;
      margin-top: 80px;
      margin-bottom: 60px;
    }

    .buttonmenu img {
      cursor: pointer;
      margin: 8px;
      height: 100px;
    }

    .personnage-hobby img {
      width: 10%;
      min-width: 50px;
      max-width: 120px;
      position: fixed;
      user-select: none;
      pointer-events: none;
    }

    .platforme-hobby img {
      width: 20%;
      min-width: 100px;
      max-width: 250px;
      position: fixed;
      bottom: 15%;
      right: 5%;
      cursor: pointer;
    }
  </style>
</head>

<body>

  <img src="assets/logohome.png" style="width:105px; position:fixed; top:10px; left:10px;"
    onclick="window.location.href='./index.html'">
  <img src="assets/logoretour.png" style="width:105px; position:fixed; top:10px; left:125px;"
    onclick="window.location.href='./index.html'">
  <img src="assets/logorefresh.png" style="width:105px; position:fixed; top:10px; right:10px;"
    onclick="window.location.href='./index.html'">
  <img src="assets/logoparametre.png" style="width:105px; position:fixed; top:10px; right:125px;"
    onclick="window.location.href='./parametre.html'">

  <h1 class="titlemenu">MENU PRINCIPAL</h1>

  <div class="buttonmenu">
    <img src="assets/logoniveaux.png" onclick="window.location.href='./niv1a10.html'"><br>
    <img src="assets/logosolo.png" onclick="window.location.href='solo.html'"><br>
    <img src="assets/logoediteur.png" onclick="window.location.href='editeur.html'"><br>
    <img src="assets/logomesniveaux.png" onclick="window.location.href='mesniveaux.html'">
  </div>

  <div class="personnage-hobby">
    <img src="assets/personnagehobby.png" alt="Personnage">
  </div>

  <div class="platforme-hobby">
    <img src="assets/platformehobby.png" alt="Plateforme">
  </div>

  <script>
    const perso = document.querySelector(".personnage-hobby img");
    const plateforme = document.querySelector(".platforme-hobby img");

    let active = false;

    // Variables de position en pixels absolus
    let x = 0;
    let y = 0;

    let velocityY = 0;
    let onPlatform = true;

    const gravity = 1.2;
    const jumpForce = 18;
    const speed = 6;

    const keys = {
      left: false,
      right: false
    };

    // Fonction pour obtenir les dimensions de la plateforme
    function getPlatformBounds() {
      const rect = plateforme.getBoundingClientRect();
      return {
        left: rect.left,
        right: rect.right,
        top: rect.top,
        bottom: rect.bottom,
        width: rect.width,
        height: rect.height
      };
    }

    // Fonction pour obtenir les dimensions du personnage
    function getPersonnageBounds() {
      const rect = perso.getBoundingClientRect();
      return {
        width: rect.width,
        height: rect.height
      };
    }

    // Fonction pour positionner le personnage sur la plateforme
    function resetPosition() {
      const platformBounds = getPlatformBounds();
      const persoBounds = getPersonnageBounds();
      
      // Positionner le personnage au centre de la plateforme, juste au-dessus
      x = platformBounds.left + (platformBounds.width / 2) - (persoBounds.width / 2);
      y = platformBounds.top - persoBounds.height;
      
      velocityY = 0;
      onPlatform = true;
      
      updatePersoPosition();
    }

    // Appliquer la position du personnage
    function updatePersoPosition() {
      perso.style.left = x + 'px';
      perso.style.top = y + 'px';
      perso.style.right = 'auto';
      perso.style.bottom = 'auto';
    }

    // Attendre que les images soient chargées
    let imagesLoaded = 0;
    function checkImagesLoaded() {
      imagesLoaded++;
      if (imagesLoaded === 2) {
        resetPosition();
      }
    }

    perso.addEventListener('load', checkImagesLoaded);
    plateforme.addEventListener('load', checkImagesLoaded);

    // Si les images sont déjà en cache
    if (perso.complete) checkImagesLoaded();
    if (plateforme.complete) checkImagesLoaded();

    // Repositionner lors du redimensionnement
    window.addEventListener('resize', () => {
      if (!active) {
        resetPosition();
      }
    });

    plateforme.addEventListener("click", () => {
      active = true;
      console.log("Easter egg activé");
    });

    document.addEventListener("keydown", (e) => {
      if (!active) return;

      if (e.key === "ArrowLeft") keys.left = true;
      if (e.key === "ArrowRight") keys.right = true;

      if (e.key === "ArrowUp" && onPlatform) {
        velocityY = -jumpForce;
        onPlatform = false;
      }
    });

    document.addEventListener("keyup", (e) => {
      if (e.key === "ArrowLeft") keys.left = false;
      if (e.key === "ArrowRight") keys.right = false;
    });

    function loop() {
      if (active) {
        const screenWidth = window.innerWidth;
        const screenHeight = window.innerHeight;
        const persoBounds = getPersonnageBounds();
        const platformBounds = getPlatformBounds();

        // Déplacement horizontal
        if (keys.left) x -= speed;
        if (keys.right) x += speed;

        // Gravité
        velocityY += gravity;
        y += velocityY;

        // Limites écran horizontales
        if (x < 0) x = 0;
        if (x + persoBounds.width > screenWidth) {
          x = screenWidth - persoBounds.width;
        }

        // Collision avec la plateforme
        const persoBottom = y + persoBounds.height;
        const persoLeft = x;
        const persoRight = x + persoBounds.width;

        // Vérifier si le personnage touche la plateforme par le bas
        if (
          velocityY > 0 && // Tombe vers le bas
          persoBottom >= platformBounds.top &&
          persoBottom <= platformBounds.top + 20 &&
          persoRight > platformBounds.left + 5 &&
          persoLeft < platformBounds.right - 5
        ) {
          y = platformBounds.top - persoBounds.height;
          velocityY = 0;
          onPlatform = true;
        } else if (persoBottom < platformBounds.top - 5) {
          onPlatform = false;
        }

        // Chute = level secret
        if (y > screenHeight + 200) {
          alert("Vous avez trouvé le niveau secret !");
          // window.location.href = "level11.html";
        }

        // Appliquer la position
        updatePersoPosition();
      }

      requestAnimationFrame(loop);
    }

    loop();
  </script>

</body>

</html>
