<!doctype html>
<html lang="fr">
<head>
    <meta charset="UTF-8" />
    <title>Solo</title>
    <link rel="icon" type="image/png" sizes="64x64" href="./favicon.png">
    <script src="https://cdn.jsdelivr.net/npm/phaser@3.11.0/dist/phaser.js"></script>

    <style>
        body {
            margin: 0;
            background-color: rgb(65, 61, 61);
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
        }

        canvas {
            border: 4px solid rgb(41, 21, 21);
            image-rendering: pixelated;
            image-rendering: crisp-edges;
        }
    </style>
</head>

<body>

<script>
/* =========================
   CONFIG PHASER (PIXEL PERFECT)
========================= */
const config = {
    type: Phaser.CANVAS,
    width: 800,
    height: 600,

    render: {
        pixelArt: true,
        antialias: false,
        roundPixels: true
    },

    physics: {
        default: 'arcade',
        arcade: {
            gravity: { y: 800 }, // üëà gravit√© r√©aliste
            debug: false
        }
    },

    scene: { preload, create, update }
};

new Phaser.Game(config);

let player, cursors, platforms;

/* =========================
   PRELOAD
========================= */
function preload() {
    this.load.image('sky', 'assets/sky.png');
    this.load.image('ground', 'assets/platform.png');

    const selectedChar = localStorage.getItem('selectedCharacter') || '1';
    this.load.spritesheet('dude', `assets/personnageframe${selectedChar}.png`, {
        frameWidth: 320,
        frameHeight: 480,
        spacing: 0,
        margin: 0
    });
}

/* =========================
   CREATE
========================= */
function create() {

    this.add.image(400, 300, 'sky');

    /* --- Plateformes --- */
    platforms = this.physics.add.staticGroup();
    platforms.create(400, 568, 'ground').setScale(2).refreshBody();

    /* --- Joueur --- */
    player = this.physics.add.sprite(100, 450, 'dude');

    // üîë r√©glages CRITIQUES
    player.setOrigin(0.5, 1);       // pieds au sol
    player.setScale(0.12);          // üëà taille correcte
    player.setCollideWorldBounds(true);
    player.setBounce(0);

    // ‚ö†Ô∏è hitbox PROPRE (ind√©pendante du sprite)
    player.body.setSize(90, 180);
    player.body.setOffset(115, 300);

    // animations
    this.anims.create({
        key: 'left',
        frames: this.anims.generateFrameNumbers('dude', { start: 0, end: 3 }),
        frameRate: 10,
        repeat: -1
    });

    this.anims.create({
        key: 'turn',
        frames: [{ key: 'dude', frame: 4 }],
        frameRate: 20
    });

    this.anims.create({
        key: 'right',
        frames: this.anims.generateFrameNumbers('dude', { start: 5, end: 8 }),
        frameRate: 10,
        repeat: -1
    });

    /* --- Collisions --- */
    this.physics.add.collider(player, platforms);

    cursors = this.input.keyboard.createCursorKeys();
}

/* =========================
   UPDATE
========================= */
function update() {

    if (cursors.left.isDown) {
        player.setVelocityX(-200);
        player.anims.play('left', true);
    }
    else if (cursors.right.isDown) {
        player.setVelocityX(200);
        player.anims.play('right', true);
    }
    else {
        player.setVelocityX(0);
        player.anims.play('turn');
    }

    if (cursors.up.isDown && player.body.blocked.down) {
        player.setVelocityY(-450); // saut net
    }
}
</script>

</body>
</html>
